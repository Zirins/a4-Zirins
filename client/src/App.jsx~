import { useState, useEffect } from "react";
import "./index.css"; // ✅ Keep Tailwind Import
import TaskList from "./components/TaskList"; // Task Display
import TaskForm from "./components/TaskForm"; // Task Entry
import Auth from "./components/Auth"; // Login/Register
import api from "./api/api"; // API Helper

function App() {
    const [user, setUser] = useState(null); // Track logged-in user

    // Check if user is authenticated (Runs once on page load)
    useEffect(() => {
        api.get("/auth/status", { withCredentials: true })
            .then((res) => setUser(res.data.user))
            .catch(() => setUser(null));
    }, []);

    return (
        <div className="min-h-screen flex flex-col items-center justify-center bg-gray-100 text-gray-800">
            <h1 className="text-4xl font-bold mb-4">📝 To-Do List</h1>

            {user ? (
                <>
                    <TaskForm />
                    <TaskList />
                    <button
                        className="mt-4 px-4 py-2 bg-red-500 text-white rounded-lg"
                        onClick={() => api.get("/auth/logout").then(() => setUser(null))}
                    >
                        Logout
                    </button>
                </>
            ) : (
                <Auth setUser={setUser} />
            )}
        </div>
    );
}

export default App;
